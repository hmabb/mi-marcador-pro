<!DOCTYPE html>
<html>
<head>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@900&display=swap" rel="stylesheet">
    <style>
        body { background: transparent; margin: 0; padding: 30px; font-family: 'Roboto', sans-serif; color: white; text-transform: uppercase; overflow: hidden; }
        
        /* Animaciones */
        .board { transition: all 0.6s cubic-bezier(0.18, 0.89, 0.32, 1.28); opacity: 0; transform: translateX(-50px); }
        .board.visible { opacity: 1; transform: translateX(0); }
        
        @keyframes pop { 0% { transform: scale(1.3); } 100% { transform: scale(1); } }
        .animate-pop { animation: pop 0.3s ease-out; }

        .banner { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.7);
            background: rgba(11, 20, 34, 0.98); border: 5px solid gold; padding: 50px; border-radius: 30px;
            opacity: 0; visibility: hidden; transition: 0.5s; text-align: center; width: 700px;
        }
        .banner.active { opacity: 1; visibility: visible; transform: translate(-50%, -50%) scale(1); }

        /* Estructura */
        .row { display: flex; height: 60px; margin-bottom: 3px; align-items: center; }
        .info { flex: 1; min-width: 350px; display: flex; align-items: center; padding: 0 25px; font-size: 26px; position: relative; }
        .logo { width: 40px; height: 40px; margin-right: 15px; object-fit: contain; }
        .sets-area { display: flex; background: #0b1422; height: 100%; }
        .set-box { width: 60px; display: flex; align-items: center; justify-content: center; font-size: 24px; border-left: 1px solid #333; color: #888; }
        .current { width: 85px; background: #1a2a44; color: #fff; font-size: 38px; font-weight: bold; border-left: 3px solid rgba(255,255,255,0.2); }
        .footer { background: #0b1422; height: 40px; display: flex; align-items: center; padding: 0 20px; font-size: 18px; border-top: 1px solid #333; justify-content: space-between; }
        .ball { margin-left: auto; opacity: 0; transition: 0.3s; filter: drop-shadow(0 0 5px gold); }
        .serving .ball { opacity: 1; }
    </style>
</head>
<body>

    <div id="main-board" class="board">
        <div class="row" id="row-h">
            <div class="info" id="bg-h"><img id="l-h" class="logo"><span id="n-h"></span><span class="ball">üèê</span></div>
            <div class="sets-area" id="hist-h"></div>
            <div class="set-box current" id="p-h">0</div>
        </div>
        <div class="row" id="row-a">
            <div class="info" id="bg-a"><img id="l-a" class="logo"><span id="n-a"></span><span class="ball">üèê</span></div>
            <div class="sets-area" id="hist-a"></div>
            <div class="set-box current" id="p-a">0</div>
        </div>
        <div class="footer"><span id="t-name"></span><span id="timer">00:00</span></div>
    </div>

    <div id="banner" class="banner">
        <h1 id="b-title" style="color: gold; font-size: 50px; margin:0;"></h1>
        <div style="display: flex; justify-content: space-around; font-size: 40px; margin: 30px 0;">
            <div><div id="bn-h"></div><div id="bp-h" style="font-size: 100px; color: gold;">0</div></div>
            <div style="align-self: center; font-size: 60px;">VS</div>
            <div><div id="bn-a"></div><div id="bp-a" style="font-size: 100px; color: gold;">0</div></div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let oldH = 0, oldA = 0;

        socket.on('update', s => {
            const board = document.getElementById('main-board');
            const banner = document.getElementById('banner');

            if(s.overlayMode === 'match') {
                board.classList.add('visible'); banner.classList.remove('active');
            } else {
                board.classList.remove('visible'); banner.classList.add('active');
                document.getElementById('b-title').innerText = s.overlayMode === 'halftime' ? 'ENTRETIEMPO' : 'FIN DEL PARTIDO';
                document.getElementById('bn-h').innerText = s.homeName; document.getElementById('bn-a').innerText = s.awayName;
                document.getElementById('bp-h').innerText = s.homeScore; document.getElementById('bp-a').innerText = s.awayScore;
            }

            if(s.homeScore !== oldH) anim('p-h'); if(s.awayScore !== oldA) anim('p-a');
            oldH = s.homeScore; oldA = s.awayScore;

            document.getElementById('n-h').innerText = s.homeName; document.getElementById('n-a').innerText = s.awayName;
            document.getElementById('p-h').innerText = s.homeScore; document.getElementById('p-a').innerText = s.awayScore;
            document.getElementById('bg-h').style.cssText = `background:${s.homeColor}; color:${s.homeTextColor}`;
            document.getElementById('bg-a').style.cssText = `background:${s.awayColor}; color:${s.awayTextColor}`;
            document.getElementById('row-h').className = s.serverSide==='home'?'row serving':'row';
            document.getElementById('row-a').className = s.serverSide==='away'?'row serving':'row';
            document.getElementById('t-name').innerText = s.tournamentName;

            if(s.homeLogo) { document.getElementById('l-h').src = s.homeLogo; document.getElementById('l-h').style.display='block'; }
            else document.getElementById('l-h').style.display='none';
            if(s.awayLogo) { document.getElementById('l-a').src = s.awayLogo; document.getElementById('l-a').style.display='block'; }
            else document.getElementById('l-a').style.display='none';

            drawH(s.homeSetsHistory, 'hist-h'); drawH(s.awaySetsHistory, 'hist-a');
        });

        socket.on('tick', d => {
            document.getElementById('timer').innerText = Math.floor(d.timer/60).toString().padStart(2,'0')+":"+(d.timer%60).toString().padStart(2,'0');
        });

        function anim(id) { const e = document.getElementById(id); e.classList.remove('animate-pop'); void e.offsetWidth; e.classList.add('animate-pop'); }
        function drawH(h, id) {
            const c = document.getElementById(id); c.innerHTML = '';
            h.forEach(v => { const d = document.createElement('div'); d.className='set-box'; d.innerText=v; c.appendChild(d); });
        }
    </script>
</body>
</html>

