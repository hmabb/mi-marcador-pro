<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #121212; color: white; padding: 15px; }
        .module { background: #1e1e1e; border-radius: 10px; padding: 15px; margin-bottom: 15px; border-left: 5px solid #444; }
        .timer-big { font-family: monospace; font-size: 2.5rem; color: #00ffcc; text-align: center; }
    </style>
</head>
<body>
    <div class="container" style="max-width: 500px;">
        <div class="module">
            <label>MODO PANTALLA</label>
            <select id="mode-sel" class="form-select bg-dark text-white mb-2" onchange="sync()">
                <option value="match">Marcador Vivo</option>
                <option value="halftime">Banner Entretiempo</option>
                <option value="final">Banner Final</option>
            </select>
            <input type="text" id="tour-in" class="form-control bg-dark text-white mb-2" onchange="sync()">
            <div class="timer-big" id="t-val">00:00</div>
            <div class="d-flex gap-2 mt-2">
                <button class="btn btn-success flex-fill" onclick="sendTimer('start')">INICIAR</button>
                <button class="btn btn-warning flex-fill" onclick="sendTimer('pause')">PAUSA</button>
                <button class="btn btn-danger" onclick="sendTimer('reset')">R</button>
            </div>
        </div>

        <div class="module" id="mod-h" style="border-color: #36ba98;">
            <input type="text" id="n-h" class="form-control bg-dark text-white mb-2" onchange="sync()">
            <div class="d-flex gap-1 mb-2">
                <input type="color" id="c-h" class="form-control form-control-color w-50" onchange="sync()">
                <input type="color" id="ct-h" class="form-control form-control-color w-50" onchange="sync()">
            </div>
            <input type="text" id="l-h" class="form-control bg-dark text-white mb-2" placeholder="URL Logo" onchange="sync()">
            <div class="d-flex gap-2 align-items-center">
                <button class="btn btn-primary btn-lg flex-fill" onclick="modScore('homeScore',1)">+1 LOCAL</button>
                <button class="btn btn-outline-warning" onclick="setSrv('home')">üèê</button>
            </div>
        </div>

        <div class="module" id="mod-a" style="border-color: #a044ff;">
            <input type="text" id="n-a" class="form-control bg-dark text-white mb-2" onchange="sync()">
            <div class="d-flex gap-1 mb-2">
                <input type="color" id="c-a" class="form-control form-control-color w-50" onchange="sync()">
                <input type="color" id="ct-a" class="form-control form-control-color w-50" onchange="sync()">
            </div>
            <input type="text" id="l-a" class="form-control bg-dark text-white mb-2" placeholder="URL Logo" onchange="sync()">
            <div class="d-flex gap-2 align-items-center">
                <button class="btn btn-primary btn-lg flex-fill" onclick="modScore('awayScore',1)">+1 VISITA</button>
                <button class="btn btn-outline-warning" onclick="setSrv('away')">üèê</button>
            </div>
        </div>

        <div class="module">
            <button class="btn btn-info w-100 mb-2" onclick="pushSet()">GUARDAR SET</button>
            <div id="hist"></div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let state = {};
        let pass = prompt("Contrase√±a de control:", "1234");

        socket.on('init', s => { state = s; ui(); });
        socket.on('update', s => { state = s; ui(); });
        socket.on('tick', d => { document.getElementById('t-val').innerText = fmt(d.timer); });

        function ui() {
            document.getElementById('tour-in').value = state.tournamentName;
            document.getElementById('mode-sel').value = state.overlayMode;
            document.getElementById('n-h').value = state.homeName; document.getElementById('n-a').value = state.awayName;
            document.getElementById('c-h').value = state.homeColor; document.getElementById('c-a').value = state.awayColor;
            document.getElementById('ct-h').value = state.homeTextColor; document.getElementById('ct-a').value = state.awayTextColor;
            document.getElementById('l-h').value = state.homeLogo; document.getElementById('l-a').value = state.awayLogo;
            
            let h = "";
            state.homeSetsHistory.forEach((v, i) => {
                h += `<div class="d-flex gap-1 mb-1"><small class="text-muted">S${i+1}</small>
                <input type="number" class="form-control form-control-sm bg-dark text-white" value="${v}" onchange="editS(${i},'h',this.value)">
                <input type="number" class="form-control form-control-sm bg-dark text-white" value="${state.awaySetsHistory[i]}" onchange="editS(${i},'a',this.value)">
                <button class="btn btn-danger btn-sm" onclick="delS(${i})">√ó</button></div>`;
            });
            document.getElementById('hist').innerHTML = h;
        }

        function sync() {
            const d = {
                password: pass,
                tournamentName: document.getElementById('tour-in').value,
                overlayMode: document.getElementById('mode-sel').value,
                homeName: document.getElementById('n-h').value, awayName: document.getElementById('n-a').value,
                homeColor: document.getElementById('c-h').value, awayColor: document.getElementById('c-a').value,
                homeTextColor: document.getElementById('ct-h').value, awayTextColor: document.getElementById('ct-a').value,
                homeLogo: document.getElementById('l-h').value, awayLogo: document.getElementById('l-a').value
            };
            socket.emit('updateAction', d);
        }

        function modScore(k, v) { state[k] = Math.max(0, state[k]+v); socket.emit('updateAction', {...state, password: pass}); }
        function setSrv(s) { state.serverSide = s; socket.emit('updateAction', {...state, password: pass}); }
        function pushSet() { state.homeSetsHistory.push(state.homeScore); state.awaySetsHistory.push(state.awayScore); state.homeScore=0; state.awayScore=0; socket.emit('updateAction', {...state, password: pass}); }
        function editS(i,t,v) { if(t==='h') state.homeSetsHistory[i]=parseInt(v); else state.awaySetsHistory[i]=parseInt(v); socket.emit('updateAction', {...state, password: pass}); }
        function delS(i) { state.homeSetsHistory.splice(i,1); state.awaySetsHistory.splice(i,1); socket.emit('updateAction', {...state, password: pass}); }
        function sendTimer(c) { socket.emit('controlTimer', {password: pass, cmd: c}); }
        function fmt(s) { return Math.floor(s/60).toString().padStart(2,'0')+":"+(s%60).toString().padStart(2,'0'); }
    </script>
</body>
</html>
