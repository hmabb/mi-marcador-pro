<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Control Voley</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #121212; color: white; padding: 15px; }
        .module { background: #1e1e1e; border-radius: 10px; padding: 20px; margin-bottom: 20px; border-left: 5px solid #333; }
        .local-mod { border-color: #36ba98; }
        .away-mod { border-color: #a044ff; }
        .score-big { font-size: 2.5rem; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container" style="max-width: 500px;">
        <div class="module">
            <h5>⏱️ PARTIDO / RELOJ</h5>
            <div class="d-flex gap-2 mb-3">
                <button class="btn btn-success flex-fill" onclick="timer('start')">Iniciar</button>
                <button class="btn btn-warning flex-fill" onclick="timer('pause')">Pausa</button>
                <button class="btn btn-danger flex-fill" onclick="timer('reset')">Reset</button>
            </div>
            <label>Set Actual:</label>
            <select class="form-select bg-dark text-white" id="set-select" onchange="changeSet()">
                <option value="1">Set 1</option>
                <option value="2">Set 2</option>
                <option value="3">Set 3</option>
                <option value="4">Set 4</option>
                <option value="5">Set 5</option>
            </select>
        </div>

        <div class="module local-mod">
            <input type="text" id="name-h" class="form-control bg-dark text-white mb-2" placeholder="Nombre Local" onchange="sync()">
            <div class="d-flex gap-2">
                <input type="color" id="color-h" class="form-control form-control-color" onchange="sync()">
                <input type="text" id="logo-h" class="form-control bg-dark text-white" placeholder="URL Logo" onchange="sync()">
            </div>
            <div class="text-center my-3">
                <div class="score-big" id="val-h">0</div>
                <button class="btn btn-primary btn-lg w-100" onclick="modify('homeScore', 1)">+ PUNTO</button>
                <button class="btn btn-outline-secondary btn-sm mt-2" onclick="modify('homeScore', -1)">-1</button>
            </div>
            <button class="btn btn-outline-info w-100" onclick="finishSet('home')">FINALIZAR SET</button>
        </div>

        <div class="module away-mod">
            <input type="text" id="name-a" class="form-control bg-dark text-white mb-2" placeholder="Nombre Visita" onchange="sync()">
            <div class="d-flex gap-2">
                <input type="color" id="color-a" class="form-control form-control-color" onchange="sync()">
                <input type="text" id="logo-a" class="form-control bg-dark text-white" placeholder="URL Logo" onchange="sync()">
            </div>
            <div class="text-center my-3">
                <div class="score-big" id="val-a">0</div>
                <button class="btn btn-primary btn-lg w-100" onclick="modify('awayScore', 1)">+ PUNTO</button>
                <button class="btn btn-outline-secondary btn-sm mt-2" onclick="modify('awayScore', -1)">-1</button>
            </div>
            <button class="btn btn-outline-info w-100" onclick="finishSet('away')">FINALIZAR SET</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let state = {};

        socket.on('init', s => { state = s; loadUI(); });
        socket.on('update', s => { state = s; loadUI(); });

        function loadUI() {
            document.getElementById('val-h').innerText = state.homeScore;
            document.getElementById('val-a').innerText = state.awayScore;
            document.getElementById('name-h').value = state.homeName;
            document.getElementById('name-a').value = state.awayName;
            document.getElementById('color-h').value = state.homeColor;
            document.getElementById('color-a').value = state.awayColor;
            document.getElementById('logo-h').value = state.homeLogo;
            document.getElementById('logo-a').value = state.awayLogo;
            document.getElementById('set-select').value = state.currentSetNum;
        }

        function sync() {
            state.homeName = document.getElementById('name-h').value;
            state.awayName = document.getElementById('name-a').value;
            state.homeColor = document.getElementById('color-h').value;
            state.awayColor = document.getElementById('color-a').value;
            state.homeLogo = document.getElementById('logo-h').value;
            state.awayLogo = document.getElementById('logo-a').value;
            socket.emit('updateAction', state);
        }

        function modify(key, val) {
            state[key] = Math.max(0, state[key] + val);
            socket.emit('updateAction', state);
        }

        function finishSet(winner) {
            state.homeSetsHistory.push(state.homeScore);
            state.awaySetsHistory.push(state.awayScore);
            state.homeScore = 0;
            state.awayScore = 0;
            state.currentSetNum++;
            socket.emit('updateAction', state);
        }

        function timer(cmd) { socket.emit('controlTimer', cmd); }
    </script>
</body>
</html>
